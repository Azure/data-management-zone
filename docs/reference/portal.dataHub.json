{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "Enterprise-Scale Analytics & AI",
            "steps": [
                {
                    "name": "basics",
                    "label": "Basics",
                    "elements": [
                        {
                            "name": "resourceScope",
                            "type": "Microsoft.Common.ResourceScope"
                        }
                    ]
                },
                {
                    "name": "landingZoneSettings",
                    "label": "Enterprise-Scale company prefix",
                    "subLabel": {
                        "preValidation": "Provide a company prefix that will be used as prefix for all resources.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Company prefix",
                    "bladeSubtitle": "Company prefix",
                    "elements": [
                        {
                            "name": "infoBox",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Enterprise-Scale Analytics & AI requires access to at least one subscription. Ensure that you have access to the specified subscriptions.",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "enterpriseScaleAnalyticsCompanyPrefix",
                            "label": "Enterprise-Scale company prefix",
                            "type": "Microsoft.Common.TextBox",
                            "visible": true,
                            "toolTip": "Provide a prefix (max 10 characters, unique at tenant-scope) for the Management Group hierarchy and other resources created as part of Enterprise-scale.",
                            "defaultValue": "",
                            "constraints": {
                                "required": true,
                                "regex": "^[a-z0-9A-Z-]{1,10}$",
                                "validationMessage": "The prefix must be 1-10 characters."
                            }
                        }
                    ]
                },
                {
                    "name": "connectivitySettings",
                    "label": "Connectivity",
                    "subLabel": {
                        "preValidation": "Provide the connectivity settings that should be used for the Data Management Zone deployment.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Connectivity Settings",
                    "bladeSubtitle": "Connectivity Settings",
                    "elements": [
                        {
                            "name": "vnet",
                            "label": {
                                "virtualNetwork": "Virtual network",
                                "subnets": "Subnets"
                            },
                            "type": "Microsoft.Network.VirtualNetworkCombo",
                            "visible": true,
                            "toolTip": {
                                "virtualNetwork": "Virtual Network for Data Management Landing Zone",
                                "subnets": "Subnets used for Data Management Landing Zone"
                            },
                            "defaultValue": {
                                "name": "",
                                "addressPrefixSize": "/16"
                            },
                            "constraints": {
                                "minAddressPrefixSize": "/24"
                            },
                            "options": {
                                "hideExisting": false
                            },
                            "subnets": {
                                "subnet1": {
                                    "label": "Azure Firewall Subnet",
                                    "defaultValue": {
                                        "name": "AzureFirewallSubnet",
                                        "addressPrefixSize": "/24"
                                    },
                                    "constraints": {
                                        "minAddressPrefixSize": "/28",
                                        "minAddressCount": 12,
                                        "requireContiguousAddresses": true
                                    }
                                },
                                "subnet2": {
                                    "label": "Subnet",
                                    "defaultValue": {
                                        "name": "dh-subnet",
                                        "addressPrefixSize": "/24"
                                    },
                                    "constraints": {
                                        "minAddressPrefixSize": "/28",
                                        "minAddressCount": 12,
                                        "requireContiguousAddresses": true
                                    }
                                },
                                "subnet3": {
                                    "label": "Private Link Subnet",
                                    "defaultValue": {
                                        "name": "dh-privatelink-subnet",
                                        "addressPrefixSize": "/24"
                                    },
                                    "constraints": {
                                        "minAddressPrefixSize": "/28",
                                        "minAddressCount": 12,
                                        "requireContiguousAddresses": true
                                    }
                                }
                            },
                            "scope": {
                                "subscriptionId": "[steps('basics').resourceScope.subscription.subscriptionId]",
                                "location": "[steps('basics').resourceScope.location.name]"
                            }
                        },
                        {
                            "name": "infoBox",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Enterprise-Scale Analytics & AI allows you to leverage your existing network infrastructure or deploy a new centralized network infrastructure.",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "enableDnsAndFirewallDeployment",
                            "label": "Deploy Firewall and Private DNS Zones",
                            "type": "Microsoft.Common.OptionsGroup",
                            "visible": true,
                            "toolTip": "If 'Yes' is selected a Firewall and Private DNS Zones will be added to the Data Management Zone.",
                            "defaultValue": "Yes",
                            "constraints": {
                                "allowedValues": [
                                    {
                                        "label": "Yes",
                                        "value": "Yes"
                                    },
                                    {
                                        "label": "No",
                                        "value": "No"
                                    }
                                ]
                            }
                        },
                        {
                            "name": "dnsServerAddresses",
                            "label": "DNS Server Private IP Addresses",
                            "type": "Microsoft.Common.TextBox",
                            "visible": "[equals(steps('connectivitySettings').enableDnsAndFirewallDeployment, 'No')]",
                            "toolTip": "Provide the private IP addresses of your DNS forwarders (e.g '10.100.0.1,10.100.0.2').",
                            "defaultValue": "10.0.0.4",
                            "constraints": {
                                "required": true,
                                "validationMessage": "Private IP addresses of the DNS forwarders (e.g '10.100.0.1,10.100.0.2')."
                            }
                        },
                        {
                            "name": "firewallAddress",
                            "label": "Firewall Private IP Address",
                            "type": "Microsoft.Common.TextBox",
                            "visible": "[equals(steps('connectivitySettings').enableDnsAndFirewallDeployment, 'No')]",
                            "toolTip": "Provide the private IP address of your Firewall (e.g 10.100.0.1).",
                            "defaultValue": "10.0.0.4",
                            "constraints": {
                                "required": true,
                                "validationMessage": "Private IPs of the Firewall (e.g 10.100.0.1)."
                            }
                        },
                        {
                            "name": "resourceGroupsApi",
                            "type": "Microsoft.Solutions.ArmApiControl",
                            "request": {
                                "method": "GET",
                                "path": "resourceGroups?api-version=2020-06-01"
                            }
                        },
                        {
                            "name": "privateDnsZoneResourceGroup",
                            "label": "Private DNS Zone resource group",
                            "type": "Microsoft.Common.DropDown",
                            "visible": "[equals(steps('connectivitySettings').enableDnsAndFirewallDeployment, 'No')]",
                            "toolTip": "Provide the resource group reference in which all private DNS zones are deployed.",
                            "multiselect": false,
                            "selectAll": true,
                            "filter": true,
                            "filterPlaceholder": "Filter items ...",
                            "multiLine": true,
                            "constraints": {
                                "allowedValues": "[map(steps('connectivitySettings').resourceGroupsApi.value, (resourceGroup) => parse(concat('{\"label\":\"', resourceGroup.name, '\",\"description\":\"', resourceGroup.location, '\",\"value\":\"', toLower(resourceGroup.id),'\"}')))]",
                                "required": true
                            }
                        }
                    ]
                },
                {
                    "name": "tags",
                    "label": "Tags",
                    "subLabel": {
                        "preValidation": "Provide tags that will be used for all resources.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Tags",
                    "bladeSubtitle": "Tags",
                    "elements": [
                        {
                            "name": "tagsByResource",
                            "label": "Tags by Resource",
                            "type": "Microsoft.Common.TagsByResource",
                            "visible": true,
                            "resources": [
                                "EnterpriseScaleAnalytics"
                            ]
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "kind": "Subscription",
            "location": "[steps('basics').resourceScope.location.name]",
            "parameters": {
                "enterpriseScaleAnalyticsCompanyPrefix": "[steps('landingZoneSettings').enterpriseScaleAnalyticsCompanyPrefix]",
                "enableDnsAndFirewall": "[equals(steps('connectivitySettings').enableDnsAndFirewallDeployment, 'Yes')]",
                "dnsServerAdresses": "[split(replace(steps('connectivitySettings').dnsServerAddresses, ' ', ''), ',')]",
                "firewallPrivateIp": "[steps('connectivitySettings').firewallAddress]",
                "privateDnsZoneResourceGroupId": "[steps('connectivitySettings').privateDnsZoneResourceGroup]",
                "tags": "[steps('tags').tagsByResource.EnterpriseScaleAnalytics]"
            }
        }
    }
}