{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "Enterprise-Scale Analytics",
            "steps": [
                {
                    "name": "basics",
                    "label": "Enterprise-Scale Analytics",
                    "elements": [
                        {
                            "name": "infoBoxEnterpriseScaleAnalytics",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Enterprise-Scale Analytics is a prescriptive reference architecture for data with reference implementation provided by Microsoft. Visit 'aka.ms/adopt/datamanagement' for more details about the solution pattern.",
                                "style": "Info",
                                "uri": "https://aka.ms/adopt/datamanagement"
                            }
                        },
                        {
                            "name": "infoBoxPurview",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Before you start the deployment, please make sure you register the 'Microsoft.Purview', 'Microsoft.EventHub' and 'Microsoft.Storage' Resource Provider (RP) in your Data Management Zone Subscription. Otherwise, the deployment may fail. If you have registered the Purview RP in an early preview phase, you may be required to re-register the 'Microsoft.Purview' RP. Please follow the link to learn how this can be done.",
                                "style": "Warning",
                                "uri": "https://docs.microsoft.com/azure/azure-resource-manager/management/resource-providers-and-types"
                            }
                        },
                        {
                            "name": "deploymentDetails",
                            "label": "Deployment Details",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "deploymentDetailsText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select an environment (Development, Test, Production) which will be used as a prefix for all resource names. Independent of the environment, the same resources get deployed.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "environment",
                                    "label": "Environment",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "Development",
                                    "toolTip": "Select the environment for the deployment.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Development",
                                                "description": "Select if you want to deploy a development environment.",
                                                "value": "dev"
                                            },
                                            {
                                                "label": "Test",
                                                "description": "Select if you want to deploy a test environment.",
                                                "value": "tst"
                                            },
                                            {
                                                "label": "Production",
                                                "description": "Select if you want to deploy a production environment.",
                                                "value": "prd"
                                            }
                                        ],
                                        "required": true
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "dataManagementZoneSettings",
                    "label": "Data Management Zone",
                    "subLabel": {
                        "preValidation": "Provide all Data Management Zone Settings.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Data Management Zone",
                    "bladeSubtitle": "Data Management Zone",
                    "elements": [
                        {
                            "name": "infoBoxDataManagementZone",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Enterprise-Scale Analytics & AI uses a single landing zone for all data governance tasks. We are advising to use a separate subscription for the Data Management Zone and each Data Landing Zone.",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "deploymentDetails",
                            "label": "Deployment Details",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "deploymentDetailsText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the subscription as well as the location in which your Data Management Zone will be deployed.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "subscriptionApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "subscriptionId",
                                    "label": "Subscription",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Subscription for your Data Management Zone.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('dataManagementZoneSettings').deploymentDetails.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.subscriptionId, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "eventHubProviderApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.EventHub/register?api-version=2021-04-01')]"
                                    }
                                },
                                {
                                    "name": "storageProviderApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.Storage/register?api-version=2021-04-01')]"
                                    }
                                },
                                {
                                    "name": "purviewProviderApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.Purview/register?api-version=2021-04-01')]"
                                    }
                                },
                                {
                                    "name": "infoBoxLocation",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Since not all service features are available in all regions, Enterprise-Scale Analytics is available in a subset of regions.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "locationsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "locations?api-version=2019-11-01"
                                    }
                                },
                                {
                                    "name": "locationName",
                                    "label": "Location",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Location for your Data Management Zone.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('dataManagementZoneSettings').deploymentDetails.locationsApi.value,(item) => contains(split('southafricanorth,southeastasia,japaneast,canadacentral,northeurope,westeurope,francecentral,germanywestcentral,uksouth,centralus,eastus,eastus2,southcentralus,westus2', ','), item.name)),(item) => parse(concat('{\"label\":\"', item.regionalDisplayName, '\",\"value\":\"', item.name, '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        },
                        {
                            "name": "dataManagementZonesName",
                            "label": "Name",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "dataManagementZonesNameText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Specify a prefix for all resource names in your Data Management Zone.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "dataManagementZonesPrefix",
                                    "label": "Data Management Zone Prefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Specify a prefix (min 1 and max 10 lowercase characters and numbers).",
                                    "constraints": {
                                        "required": true,
                                        "validations": [
                                            {
                                                "regex": "^[a-z0-9]{1,10}$",
                                                "message": "The prefix must be between 1-10 lowercase characters and numbers."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataManagementZoneSettings').dataManagementZonesName.keyVaultNameApi.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataManagementZoneSettings').dataManagementZonesName.containerRegistryNameApi.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataManagementZoneSettings').dataManagementZonesName.purviewNameApi.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "keyVaultNameApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.KeyVault/checkNameAvailability?api-version=2019-09-01')]",
                                        "body": {
                                            "name": "[concat(steps('dataManagementZoneSettings').dataManagementZonesName.dataManagementZonesPrefix, '-', steps('basics').deploymentDetails.environment, '-vault001')]",
                                            "type": "Microsoft.KeyVault/vaults"
                                        }
                                    }
                                },
                                {
                                    "name": "containerRegistryNameApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.ContainerRegistry/checkNameAvailability?api-version=2019-05-01')]",
                                        "body": {
                                            "name": "[concat(steps('dataManagementZoneSettings').dataManagementZonesName.dataManagementZonesPrefix, steps('basics').deploymentDetails.environment, 'containerregistry001')]",
                                            "type": "Microsoft.ContainerRegistry/registries"
                                        }
                                    }
                                },
                                {
                                    "name": "purviewNameApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.Purview/checkNameAvailability?api-version=2020-12-01-preview')]",
                                        "body": {
                                            "name": "[concat(steps('dataManagementZoneSettings').dataManagementZonesName.dataManagementZonesPrefix, '-', steps('basics').deploymentDetails.environment, '-purview001')]",
                                            "type": "Microsoft.Purview/accounts"
                                        }
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "dataLandingZoneSettings",
                    "label": "Data Landing Zones",
                    "subLabel": {
                        "preValidation": "Provide all Data Landing Zone Settings.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Data Landing Zones",
                    "bladeSubtitle": "Data Landing Zones",
                    "elements": [
                        {
                            "name": "infoBoxDataLandingZone",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Enterprise-Scale Analytics advises to scale data workloads through the means of one or multiple Data Landing Zones. Each Data Landing Zone should be deployed to a separate subscription.",
                                "style": "Info"
                            }
                        },
                        {
                            "name": "deploymentDetails",
                            "label": "Deployment Details",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "deploymentDetailsText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select the subscription as well as the location in which your Data Landing Zones will be deployed.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "infoBoxLocation",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Since not all service features are available in all regions, Enterprise-Scale Analytics is available in a subset of regions.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "subscriptionApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "locationsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "locations?api-version=2019-11-01"
                                    }
                                },
                                {
                                    "name": "dataLandingZones",
                                    "ariaLabel": "Enter information per Data Landing Zone",
                                    "label": "Data Landing Zones",
                                    "type": "Microsoft.Common.EditableGrid",
                                    "visible": true,
                                    "constraints": {
                                        "width": "Full",
                                        "rows": {
                                            "count": {
                                                "min": 1,
                                                "max": 50
                                            }
                                        },
                                        "columns": [
                                            {
                                                "id": "subscription",
                                                "header": "Subscription",
                                                "width": "1fr",
                                                "element": {
                                                    "name": "subscription",
                                                    "type": "Microsoft.Common.DropDown",
                                                    "placeholder": "Select a subscription...",
                                                    "multiselect": false,
                                                    "selectAll": false,
                                                    "filter": true,
                                                    "filterPlaceholder": "Filter items ...",
                                                    "multiLine": true,
                                                    "constraints": {
                                                        "allowedValues": "[map(steps('dataLandingZoneSettings').deploymentDetails.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.subscriptionId, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                                                        "required": true
                                                    }
                                                }
                                            },
                                            {
                                                "id": "location",
                                                "header": "Location",
                                                "width": "1fr",
                                                "element": {
                                                    "name": "location",
                                                    "type": "Microsoft.Common.DropDown",
                                                    "placeholder": "Select a location...",
                                                    "multiselect": false,
                                                    "selectAll": false,
                                                    "filter": true,
                                                    "filterPlaceholder": "Filter items ...",
                                                    "multiLine": true,
                                                    "constraints": {
                                                        "allowedValues": "[map(filter(steps('dataLandingZoneSettings').deploymentDetails.locationsApi.value,(item) => contains(split('southafricanorth,southeastasia,japaneast,canadacentral,northeurope,westeurope,francecentral,germanywestcentral,uksouth,centralus,eastus,eastus2,southcentralus,westus2', ','), item.name)),(item) => parse(concat('{\"label\":\"', item.regionalDisplayName, '\",\"value\":\"', item.name, '\"}')))]",
                                                        "required": true
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                }
                            ]
                        },
                        {
                            "name": "dataLandingZonesName",
                            "label": "Name",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "dataLandingZonesNameText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Specify a prefix for all resource names in your Data Landing Zone. The Data Landing Zones will be numbered as part of the deployment.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "dataLandingZonesPrefix",
                                    "label": "Data Landing Zone Prefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Specify a prefix (min 1 and max 7 lowercase characters and numbers).",
                                    "constraints": {
                                        "required": true,
                                        "validations": [
                                            {
                                                "regex": "^[a-z0-9]{1,7}$",
                                                "message": "The prefix must be between 1-7 lowercase characters and numbers."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataLandingZoneSettings').dataLandingZonesName.keyVaultNameApi001.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataLandingZoneSettings').dataLandingZonesName.keyVaultNameApi002.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataLandingZoneSettings').dataLandingZonesName.keyVaultNameApi003.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataLandingZoneSettings').dataLandingZonesName.storageAccountNameApi001.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataLandingZoneSettings').dataLandingZonesName.storageAccountNameApi002.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataLandingZoneSettings').dataLandingZonesName.storageAccountNameApi003.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataLandingZoneSettings').dataLandingZonesName.storageAccountNameApi004.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataLandingZoneSettings').dataLandingZonesName.storageAccountNameApi005.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataLandingZoneSettings').dataLandingZonesName.eventHubNamespaceNameApi.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataLandingZoneSettings').dataLandingZonesName.mySqlServerNameApi.nameAvailable, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataLandingZoneSettings').dataLandingZonesName.sqlServerNameApi.available, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            },
                                            {
                                                "isValid": "[not(equals(steps('dataLandingZoneSettings').dataLandingZonesName.synapseNameApi.available, false))]",
                                                "message": "Prefix currently unavailable. Please choose a different one."
                                            }
                                        ]
                                    }
                                },
                                {
                                    "name": "keyVaultNameApi001",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.KeyVault/checkNameAvailability?api-version=2019-09-01')]",
                                        "body": {
                                            "name": "[concat(steps('dataLandingZoneSettings').dataLandingZonesName.dataLandingZonesPrefix, '001', '-', steps('basics').deploymentDetails.environment, '-vault001')]",
                                            "type": "Microsoft.KeyVault/vaults"
                                        }
                                    }
                                },
                                {
                                    "name": "keyVaultNameApi002",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.KeyVault/checkNameAvailability?api-version=2019-09-01')]",
                                        "body": {
                                            "name": "[concat(steps('dataLandingZoneSettings').dataLandingZonesName.dataLandingZonesPrefix, '001', '-', steps('basics').deploymentDetails.environment, '-vault002')]",
                                            "type": "Microsoft.KeyVault/vaults"
                                        }
                                    }
                                },
                                {
                                    "name": "keyVaultNameApi003",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.KeyVault/checkNameAvailability?api-version=2019-09-01')]",
                                        "body": {
                                            "name": "[concat(steps('dataLandingZoneSettings').dataLandingZonesName.dataLandingZonesPrefix, '001', '-', steps('basics').deploymentDetails.environment, '-vault003')]",
                                            "type": "Microsoft.KeyVault/vaults"
                                        }
                                    }
                                },
                                {
                                    "name": "storageAccountNameApi001",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.Storage/checkNameAvailability?api-version=2021-04-01')]",
                                        "body": {
                                            "name": "[concat(steps('dataLandingZoneSettings').dataLandingZonesName.dataLandingZonesPrefix, '001', steps('basics').deploymentDetails.environment, 'raw')]",
                                            "type": "Microsoft.Storage/storageAccounts"
                                        }
                                    }
                                },
                                {
                                    "name": "storageAccountNameApi002",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.Storage/checkNameAvailability?api-version=2021-04-01')]",
                                        "body": {
                                            "name": "[concat(steps('dataLandingZoneSettings').dataLandingZonesName.dataLandingZonesPrefix, '001', steps('basics').deploymentDetails.environment, 'encur')]",
                                            "type": "Microsoft.Storage/storageAccounts"
                                        }
                                    }
                                },
                                {
                                    "name": "storageAccountNameApi003",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.Storage/checkNameAvailability?api-version=2021-04-01')]",
                                        "body": {
                                            "name": "[concat(steps('dataLandingZoneSettings').dataLandingZonesName.dataLandingZonesPrefix, '001', steps('basics').deploymentDetails.environment, 'work')]",
                                            "type": "Microsoft.Storage/storageAccounts"
                                        }
                                    }
                                },
                                {
                                    "name": "storageAccountNameApi004",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.Storage/checkNameAvailability?api-version=2021-04-01')]",
                                        "body": {
                                            "name": "[concat(steps('dataLandingZoneSettings').dataLandingZonesName.dataLandingZonesPrefix, '001', steps('basics').deploymentDetails.environment, 'ext001')]",
                                            "type": "Microsoft.Storage/storageAccounts"
                                        }
                                    }
                                },
                                {
                                    "name": "storageAccountNameApi005",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.Storage/checkNameAvailability?api-version=2021-04-01')]",
                                        "body": {
                                            "name": "[concat(steps('dataLandingZoneSettings').dataLandingZonesName.dataLandingZonesPrefix, '001', steps('basics').deploymentDetails.environment, 'artfct001')]",
                                            "type": "Microsoft.Storage/storageAccounts"
                                        }
                                    }
                                },
                                {
                                    "name": "eventHubNamespaceNameApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.EventHub/checkNameAvailability?api-version=2017-04-01')]",
                                        "body": {
                                            "name": "[concat(steps('dataLandingZoneSettings').dataLandingZonesName.dataLandingZonesPrefix, '001', '-', steps('basics').deploymentDetails.environment, '-integration-eventhub001')]"
                                        }
                                    }
                                },
                                {
                                    "name": "mySqlServerNameApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.DBforMySQL/checkNameAvailability?api-version=2017-12-01')]",
                                        "body": {
                                            "name": "[concat(steps('dataLandingZoneSettings').dataLandingZonesName.dataLandingZonesPrefix, '001', '-', steps('basics').deploymentDetails.environment, '-mysqlserver001')]",
                                            "type": "Microsoft.DBforMySQL"
                                        }
                                    }
                                },
                                {
                                    "name": "sqlServerNameApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.Sql/checkNameAvailability?api-version=2021-02-01-preview')]",
                                        "body": {
                                            "name": "[concat(steps('dataLandingZoneSettings').dataLandingZonesName.dataLandingZonesPrefix, '001', '-', steps('basics').deploymentDetails.environment, '-sqlserver001')]",
                                            "type": "Microsoft.Sql/servers"
                                        }
                                    }
                                },
                                {
                                    "name": "synapseNameApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "POST",
                                        "path": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId, '/providers/Microsoft.Synapse/checkNameAvailability?api-version=2021-03-01')]",
                                        "body": {
                                            "name": "[concat(steps('dataLandingZoneSettings').dataLandingZonesName.dataLandingZonesPrefix, '001', '-', steps('basics').deploymentDetails.environment, '-product-synapse001')]",
                                            "type": "Microsoft.Synapse/workspaces"
                                        }
                                    }
                                }
                            ]
                        },
                        {
                            "name": "dataLandingZonesServicesSettings",
                            "label": "Services Settings",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "administratorPasswordText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Select an administrator password for the Synapse workspaces and Self-hosted integration runtimes hosted on VMSS (Username: 'SuperMainUser').",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "administratorPassword",
                                    "label": {
                                        "password": "Password",
                                        "confirmPassword": "Confirm password"
                                    },
                                    "type": "Microsoft.Compute.CredentialsCombo",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": {
                                        "password": "Specify an administrator password for the Synapse workspaces and Self-hosted integration runtimes hosted on VMSS."
                                    },
                                    "constraints": {
                                        "required": true,
                                        "customPasswordRegex": "^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,128}$",
                                        "customValidationMessage": "The password must be alphanumeric, contain at least 8 characters, and have at least 1 letter, 1 number and one special character."
                                    },
                                    "options": {
                                        "hideConfirmation": false
                                    },
                                    "osPlatform": "Windows"
                                }
                            ]
                        },
                        {
                            "name": "azureBastionSettings",
                            "label": "Azure Bastion Settings",
                            "type": "Microsoft.Common.Section",
                            "visible": true,
                            "elements": [
                                {
                                    "name": "azureBastionText",
                                    "type": "Microsoft.Common.TextBlock",
                                    "visible": true,
                                    "options": {
                                        "text": "Specify whether you want to deploy Azure Bastion in the first Data Landing Zone.",
                                        "link": {
                                            "label": "",
                                            "uri": ""
                                        }
                                    }
                                },
                                {
                                    "name": "azureBastionCheckbox",
                                    "label": "Deploy Azure Bastion",
                                    "type": "Microsoft.Common.CheckBox",
                                    "visible": true,
                                    "defaultValue": false,
                                    "toolTip": "Enable the deployment of Azure Bastion and jumpbox in the first Data Landing Zone.",
                                    "constraints": {
                                        "required": false,
                                        "validationMessage": "Enable deployment of Azure Bastion and jumpbox inside the first Data Landing Zone."
                                    }
                                },
                                {
                                    "name": "virtualMachineImage",
                                    "label": "VM Image",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": "[steps('dataLandingZoneSettings').azureBastionSettings.azureBastionCheckbox]",
                                    "defaultValue": "Windows 11",
                                    "toolTip": "Specify the SKU of the Virtual Machine.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Windows 11",
                                                "description": "Windows 11 Enterprise 21H2",
                                                "value": "Windows11"
                                            },
                                            {
                                                "label": "Windows Server 2022",
                                                "description": "Windows Server 2022 Datacenter",
                                                "value": "WindowsServer2022"
                                            }
                                        ],
                                        "required": true
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "tags",
                    "label": "Tags",
                    "subLabel": {
                        "preValidation": "Provide tags that will be used for all resources.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Tags",
                    "bladeSubtitle": "Tags",
                    "elements": [
                        {
                            "name": "tagsByResource",
                            "label": "Tags by Resource",
                            "type": "Microsoft.Common.TagsByResource",
                            "visible": true,
                            "resources": [
                                "EnterpriseScaleAnalytics"
                            ]
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "kind": "Subscription",
            "location": "[steps('dataManagementZoneSettings').deploymentDetails.locationName]",
            "subscriptionId": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId)]",
            "parameters": {
                "environment": "[steps('basics').deploymentDetails.environment]",
                "dataManagementZoneSubscriptionId": "[steps('dataManagementZoneSettings').deploymentDetails.subscriptionId]",
                "dataManagementZonePrefix": "[steps('dataManagementZoneSettings').dataManagementZonesName.dataManagementZonesPrefix]",
                "dataManagementZoneLocation": "[steps('dataManagementZoneSettings').deploymentDetails.locationName]",
                "administratorUsername": "SuperMainUser",
                "administratorPassword": "[steps('dataLandingZoneSettings').dataLandingZonesServicesSettings.administratorPassword.password]",
                "dataLandingZoneDetails": "[steps('dataLandingZoneSettings').deploymentDetails.dataLandingZones]",
                "dataLandingZonePrefix": "[steps('dataLandingZoneSettings').dataLandingZonesName.dataLandingZonesPrefix]",
                "enableBastionHostDeployment": "[steps('dataLandingZoneSettings').azureBastionSettings.azureBastionCheckbox]",
                "virtualMachineImage": "[if(empty(steps('dataLandingZoneSettings').azureBastionSettings.virtualMachineImage), '', steps('dataLandingZoneSettings').azureBastionSettings.virtualMachineImage)]",
                "tags": "[if(not(contains(steps('tags').tagsByResource, 'EnterpriseScaleAnalytics')), parse('{}'), first(map(parse(concat('[', string(steps('tags').tagsByResource), ']')), (item) => item.EnterpriseScaleAnalytics)))]"
            }
        }
    }
}