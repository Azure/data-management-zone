{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "Enterprise-Scale Analytics",
            "steps": [
                {
                    "name": "basics",
                    "label": "Enterprise-Scale Analytics",
                    "elements": [
                        {
							"name": "deploymentDetails",
							"label": "Deployment Details",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
                                    "name": "infoBoxEnterpriseScaleAnalytics",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Enterprise-Scale Analytics is a prescriptive reference architecture for data with reference implementation provided by Microsoft. Visit 'aka.ms/adopt/datamanagement' for more details about the solution pattern.",
                                        "style": "Info",
                                        "uri": "https://aka.ms/adopt/datamanagement"
                                    }
                                },
                                {
                                    "name": "environment",
                                    "label": "Environment",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "Development",
                                    "toolTip": "Select the environment for the deployment.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Development",
                                                "description": "Select if you want to deploy a development environment.",
                                                "value": "dev"
                                            },
                                            {
                                                "label": "Test",
                                                "description": "Select if you want to deploy a test environment.",
                                                "value": "tst"
                                            },
                                            {
                                                "label": "Production",
                                                "description": "Select if you want to deploy a production environment.",
                                                "value": "prd"
                                            }
                                        ],
                                        "required": true
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "dataManagementZoneSettings",
                    "label": "Data Management Zone",
                    "subLabel": {
                        "preValidation": "Provide all Data Management Zone Settings.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Data Management Zone",
                    "bladeSubtitle": "Data Management Zone",
                    "elements": [
                        {
                            "name": "infoBoxDataManagementZone",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Enterprise-Scale Analytics & AI uses a single landing zone for all data governance tasks. We are advising to use a separate subscription for Data Management Zone and Data Landing Zones.",
                                "style": "Info"
                            }
                        },
                        {
							"name": "dataManagementZonesName",
							"label": "Name",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
									"name": "dataManagementZonesNameText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Specify a prefix for all resource names in your Data Management Zone.",
										"link": {
											"label": "",
											"uri": ""
										}
									}
								},
                                {
                                    "name": "dataManagementZonesPrefix",
                                    "label": "Data Management Zone Prefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Specify a prefix (min 1 and max 10 lowercase characters and numbers).",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9]{1,10}$",
                                        "validationMessage": "The prefix must be between 1-10 lowercase characters and numbers."
                                    }
                                }
                            ]
                        },
                        {
							"name": "deploymentDetails",
							"label": "Deployment Details",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
									"name": "deploymentDetailsText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Select the subscription as well as the location in which your Data Management Zone will be deployed.",
										"link": {
											"label": "",
											"uri": ""
										}
									}
								},
                                {
                                    "name": "subscriptionApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "subscriptionId",
                                    "label": "Subscription",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Subscription of your Data Management Zone.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('dataManagementZoneSettings').deploymentDetails.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.subscriptionId, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "infoBoxLocation",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Since not all service features are available in all regions, Enterprise Scale Analytics is available in a subset of regions.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "locationsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "locations?api-version=2019-11-01"
                                    }
                                },
                                {
                                    "name": "locationName",
                                    "label": "Location",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Location for your Data Product Deployment.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('dataManagementZoneSettings').deploymentDetails.locationsApi.value,(item) => contains(split('southafricanorth,southeastasia,japaneast,canadacentral,northeurope,westeurope,francecentral,germanywestcentral,uksouth,centralus,eastus,eastus2,southcentralus,westus2', ','), item.name)),(item) => parse(concat('{\"label\":\"', item.regionalDisplayName, '\",\"value\":\"', item.name, '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "dataLandingZoneSettings",
                    "label": "Data Landing Zones",
                    "subLabel": {
                        "preValidation": "Provide all Data Landing Zone Settings.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Data Landing Zones",
                    "bladeSubtitle": "Data Landing Zones",
                    "elements": [
                        {
                            "name": "infoBoxDataLandingZone",
                            "type": "Microsoft.Common.InfoBox",
                            "visible": true,
                            "options": {
                                "text": "Enterprise-Scale Analytics advises to scale data workloads through the means of one or multiple Data Landing Zones. Each Data Landing Zone should be deployed to a separate subscription.",
                                "style": "Info"
                            }
                        },
                        {
							"name": "dataManagementZonesName",
							"label": "Name",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
									"name": "dataLandingZonesNameText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Specify a prefix for all resource names in your Data Landing Zone. The Data Landing Zones will be numbered as part of the deployment.",
										"link": {
											"label": "",
											"uri": ""
										}
									}
								},
                                {
                                    "name": "dataLandingZonesPrefix",
                                    "label": "Data Landing Zone Prefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Specify a prefix (min 1 and max 10 lowercase characters and numbers).",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9]{1,7}$",
                                        "validationMessage": "The prefix must be between 1-7 lowercase characters and numbers."
                                    }
                                }
                            ]
                        },
                        {
							"name": "deploymentDetails",
							"label": "Deployment Details",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
									"name": "deploymentDetailsText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Select the subscription as well as the location in which your Data Landing Zones will be deployed.",
										"link": {
											"label": "",
											"uri": ""
										}
									}
								},
                                {
                                    "name": "infoBoxLocation",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Since not all service features are available in all regions, Enterprise Scale Analytics is available in a subset of regions.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "subscriptionApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "locationsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "locations?api-version=2019-11-01"
                                    }
                                },
                                {
                                    "name": "dataLandingZones",
                                    "ariaLabel": "Enter information per Data Landing Zone",
                                    "label": "Data Landing Zones",
                                    "type": "Microsoft.Common.EditableGrid",
                                    "visible": true,
                                    "constraints": {
                                        "width": "Full",
                                        "rows": {
                                            "count": {
                                                "min": 1,
                                                "max": 50
                                            }
                                        },
                                        "columns": [
                                            {
                                                "id": "subscription",
                                                "header": "Subscription",
                                                "width": "1fr",
                                                "element": {
                                                    "name": "subscription",
                                                    "type": "Microsoft.Common.DropDown",
                                                    "placeholder": "Select a subscription...",
                                                    "constraints": {
                                                        "allowedValues": "[map(steps('dataLandingZoneSettings').deploymentDetails.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.subscriptionId, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                                                        "required": true
                                                    }
                                                }
                                            },
                                            {
                                                "id": "location",
                                                "header": "Location",
                                                "width": "1fr",
                                                "element": {
                                                    "name": "location",
                                                    "type": "Microsoft.Common.DropDown",
                                                    "placeholder": "Select a location...",
                                                    "constraints": {
                                                        "allowedValues": "[map(filter(steps('dataLandingZoneSettings').deploymentDetails.locationsApi.value,(item) => contains(split('southafricanorth,southeastasia,japaneast,canadacentral,northeurope,westeurope,francecentral,germanywestcentral,uksouth,centralus,eastus,eastus2,southcentralus,westus2', ','), item.name)),(item) => parse(concat('{\"label\":\"', item.regionalDisplayName, '\",\"value\":\"', item.name, '\"}')))]",
                                                        "required": true
                                                    }
                                                }
                                            }
                                        ]
                                    }
                                },
                                {
									"name": "administratorPasswordText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Select an administrator password for the Synapse workspaces and Self-hosted integration runtimes hosted on VMSS.",
										"link": {
											"label": "",
											"uri": ""
										}
									}
								},
                                {
                                    "name": "administratorPassword",
                                    "label": {
                                        "password": "Password",
                                        "confirmPassword": "Confirm password"
                                    },
                                    "type": "Microsoft.Compute.CredentialsCombo",
                                    "visible": "[equals(steps('generalSettings').dataProcessingServiceDeploymentSettings.processingService, 'synapse')]",
                                    "defaultValue": "",
                                    "toolTip": {
                                        "password": "Specify an administrator password for the Synapse workspaces and Self-hosted integration runtimes hosted on VMSS."
                                    },
                                    "constraints": {
                                        "required": true,
                                        "customPasswordRegex": "^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,128}$",
                                        "customValidationMessage": "The password must be alphanumeric, contain at least 8 characters, and have at least 1 letter, 1 number and one special character."
                                    },
                                    "options": {
                                        "hideConfirmation": false
                                    },
                                    "osPlatform": "Windows"
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "tags",
                    "label": "Tags",
                    "subLabel": {
                        "preValidation": "Provide tags that will be used for all resources.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Tags",
                    "bladeSubtitle": "Tags",
                    "elements": [
                        {
                            "name": "tagsByResource",
                            "label": "Tags by Resource",
                            "type": "Microsoft.Common.TagsByResource",
                            "visible": true,
                            "resources": [
                                "EnterpriseScaleAnalytics"
                            ]
                        }
                    ]
                }
            ]
        },
        "outputs": {
            "kind": "Subscription",
            "location": "[steps('dataManagementZoneSettings').deploymentDetails.locationName]",
            "subscriptionId": "[concat('/subscriptions/', steps('dataManagementZoneSettings').deploymentDetails.subscriptionId)]",
            "parameters": {
                "environment": "[steps('basics').deploymentDetails.environment]",
                "administratorPassword": "",
                "dataManagementZoneSubscriptionId": "[steps('dataManagementZoneSettings').deploymentDetails.subscriptionId]",
                "dataManagementZonePrefix": "[steps('dataManagementZoneSettings').dataManagementZonesName.dataManagementZonesPrefix]",
                "dataManagementZoneLocation": "[steps('dataManagementZoneSettings').deploymentDetails.locationName]",
                "dataLandingZoneDetails": "[steps('dataLandingZoneSettings').deploymentDetails.dataLandingZones]",
                "dataLandingZonePrefix": "[steps('dataLandingZoneSettings').dataManagementZonesName.dataLandingZonesPrefix]",
                "tags": "[steps('tags').tagsByResource.EnterpriseScaleAnalytics]"
            }
        }
    }
}