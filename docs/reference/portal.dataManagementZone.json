{
    "$schema": "<relative path to createFormUI.schema.json>",
    "view": {
        "kind": "Form",
        "properties": {
            "title": "Enterprise-Scale Analytics - Data Management Zone",
            "steps": [
                {
                    "name": "basics",
                    "label": "Data Management Zone",
                    "elements": [
                        {
							"name": "deploymentDetails",
							"label": "Deployment Details",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
									"name": "deploymentDetailsText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Select the subscription and resource group as well as the location to specify the scope of your Data Product deployment.",
										"link": {
											"label": "",
											"uri": ""
										}
									}
								},
                                {
                                    "name": "infoBoxEnterpriseScaleAnalytics",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Enterprise-Scale Analytics is a prescriptive reference architecture for data with reference implementation provided by Microsoft. Visit 'aka.ms/adopt/datamanagement' for more details about the solution pattern.",
                                        "style": "Info",
                                        "uri": "https://aka.ms/adopt/datamanagement"
                                    }
                                },
                                {
                                    "name": "subscriptionApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "subscriptions?api-version=2020-01-01"
                                    }
                                },
                                {
                                    "name": "subscriptionId",
                                    "label": "Subscription",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Subscription of your Data Landing Zone.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(steps('basics').deploymentDetails.subscriptionApi.value, (item) => parse(concat('{\"label\":\"', item.displayName, '\",\"value\":\"', item.id, '\",\"description\":\"', 'ID: ', item.subscriptionId, '\"}')))]",
                                        "required": true
                                    }
                                },
                                {
                                    "name": "infoBoxLocation",
                                    "type": "Microsoft.Common.InfoBox",
                                    "visible": true,
                                    "options": {
                                        "text": "Since not all service features are available in all regions, Enterprise Scale Analytics is available in a subset of regions.",
                                        "style": "Info"
                                    }
                                },
                                {
                                    "name": "locationsApi",
                                    "type": "Microsoft.Solutions.ArmApiControl",
                                    "request": {
                                        "method": "GET",
                                        "path": "locations?api-version=2019-11-01"
                                    }
                                },
                                {
                                    "name": "locationName",
                                    "label": "Location",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Select the Location for your Deployment.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": "[map(filter(steps('basics').deploymentDetails.locationsApi.value,(item) => contains(split('southafricanorth,southeastasia,japaneast,canadacentral,northeurope,westeurope,francecentral,germanywestcentral,uksouth,centralus,eastus,eastus2,southcentralus,westus2', ','), item.name)),(item) => parse(concat('{\"label\":\"', item.regionalDisplayName, '\",\"value\":\"', item.name, '\"}')))]",
                                        "required": true
                                    }
                                }
                            ]
                        },
                        {
							"name": "dataManagementZoneName",
							"label": "Data Management Zone Name",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
									"name": "dataManagementZoneNameText",
									"type": "Microsoft.Common.TextBlock",
									"visible": true,
									"options": {
										"text": "Specify a prefix and environment name which will be used as a prefix for all resource names.",
										"link": {
											"label": "",
											"uri": ""
										}
									}
								},
                                {
                                    "name": "dataManagementZonePrefix",
                                    "label": "Data Management Zone Prefix",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": true,
                                    "defaultValue": "",
                                    "toolTip": "Specify a prefix (min 1 and max 10 lowercase characters and numbers).",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^[a-z0-9]{1,10}$",
                                        "validationMessage": "The prefix must be between 1-10 lowercase characters and numbers."
                                    }
                                },
                                {
                                    "name": "environment",
                                    "label": "Environment",
                                    "type": "Microsoft.Common.DropDown",
                                    "visible": true,
                                    "defaultValue": "Development",
                                    "toolTip": "Select the environment for the deployment.",
                                    "multiselect": false,
                                    "selectAll": false,
                                    "filter": true,
                                    "filterPlaceholder": "Filter items ...",
                                    "multiLine": true,
                                    "constraints": {
                                        "allowedValues": [
                                            {
                                                "label": "Development",
                                                "description": "Select if you want to deploy a development environment.",
                                                "value": "dev"
                                            },
                                            {
                                                "label": "Test",
                                                "description": "Select if you want to deploy a test environment.",
                                                "value": "tst"
                                            },
                                            {
                                                "label": "Production",
                                                "description": "Select if you want to deploy a production environment.",
                                                "value": "prd"
                                            }
                                        ],
                                        "required": true
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "generalSettings",
                    "label": "General Settings",
                    "subLabel": {
                        "preValidation": "Provide all general settings for your Data Management Zone.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "General Settings",
                    "bladeSubtitle": "General Settings",
                    "elements": []
                },
                {
                    "name": "connectivitySettings",
                    "label": "Connectivity Settings",
                    "subLabel": {
                        "preValidation": "Provide all connectivity settings for your Data Management Zone.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Connectivity Settings",
                    "bladeSubtitle": "Connectivity Settings",
                    "elements": [
                        {
							"name": "virtualNetworkConfiguration",
							"label": "Virtual Network Configuration",
							"type": "Microsoft.Common.Section",
                            "visible": true,
							"elements": [
                                {
                                    "name": "virtualNetworkAddressCidrRange",
                                    "label": "Vnet Address CIDR Range",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": true,
                                    "defaultValue": "10.0.0.0/16",
                                    "toolTip": "Specify a Vnet address CIDR range within the range [10,24].",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:$|/(1[0-9]|2[0-4]))$",
                                        "validationMessage": "Invalid CIDR range. The address prefix must be in the range [10,24]."
                                    }
                                },
                                {
                                    "name": "azureFirewallSubnetCidrRange",
                                    "label": "Azure Firewall Subnet CIDR Range",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": true,
                                    "defaultValue": "10.0.0.0/24",
                                    "toolTip": "Specify a CIDR range for the Azure Firewall Subnet within the range [24,28].",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:$|/(2[4-8]))$",
                                        "validationMessage": "Invalid CIDR range. The address prefix must be in the range [24,28]."
                                    }
                                },
                                {
                                    "name": "servicesSubnetCidrRange",
                                    "label": "Services Subnet CIDR Range",
                                    "type": "Microsoft.Common.TextBox",
                                    "visible": true,
                                    "defaultValue": "10.0.1.0/24",
                                    "toolTip": "Specify a CIDR range for the Subnet to which privat endpoints and other services will be connected. The subnet should be within the range [24,28].",
                                    "constraints": {
                                        "required": true,
                                        "regex": "^(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)\\.(25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]?\\d)(?:$|/(2[4-8]))$",
                                        "validationMessage": "Invalid CIDR range. The address prefix must be in the range [24,28]."
                                    }
                                }
                            ]
                        }
                    ]
                },
                {
                    "name": "tags",
                    "label": "Tags",
                    "subLabel": {
                        "preValidation": "Provide tags that will be used for all resources.",
                        "postValidation": "Done"
                    },
                    "bladeTitle": "Tags",
                    "bladeSubtitle": "Tags",
                    "elements": [
                        {
                            "name": "tagsByResource",
                            "label": "Tags by Resource",
                            "type": "Microsoft.Common.TagsByResource",
                            "visible": true,
                            "resources": [
                                "EnterpriseScaleAnalytics"
                            ]
                        }
                    ]
                }
            ]
        },
        "deployment": {
            "kind": "Subscription",
            "location": "[steps('basics').deploymentDetails.locationName]",
            "parameters": {
                "environment": "[steps('basics').dataManagementZoneName.environment]",
                "tags": "[steps('tags').tagsByResource.EnterpriseScaleAnalytics]"
            }
        }
    }
}